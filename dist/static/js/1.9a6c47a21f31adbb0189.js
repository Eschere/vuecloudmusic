webpackJsonp([1],{B90M:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("Dd8w"),a=n.n(i),r=n("NYxO"),s=n("0xDb"),o=n("hU7x"),c=n.n(o),l={props:["direction"],data:function(){return{pnncd:[],panningStyle:"",protecting:"",doingChangeSong:"",stopAnimation:"",commentnum:""}},computed:a()({},Object(r.e)("player",["running","currentSong","playlist","cdMoveDirection"]),Object(r.c)("player",["playOrder"]),Object(r.c)("config",["currentServer"])),methods:a()({},Object(r.d)("player",["changeCdMoveDirection"]),Object(r.b)("player",["changeSong"]),{togglePage:function(t){t.srcEvent.stopPropagation(),t.srcEvent.stopImmediatePropagation(),t.preventDefault(),this.$emit("togglepage")},panHandler:function(t){var e=this;if(this.protecting)return!1;if(this.doingChangeSong=!0,this.panningStyle={transform:"translate3d(-100vw, 0, 0) translate3d("+t.deltaX+"px,0,0)"},t.isFinal){var n=document.documentElement.clientWidth;t.deltaX/n>.45?(this.protecting=!0,this.changeSong({type:"prev",beforeChange:function(){setTimeout(function(){e.protecting=!1,e.doingChangeSong=!1},200),e.panningStyle={transition:"all .2s ease-out"}}})):t.deltaX/n<-.45?(this.protecting=!0,this.changeSong({type:"next",beforeChange:function(){setTimeout(function(){e.protecting=!1,e.doingChangeSong=!1},200),e.panningStyle={transition:"all .2s ease-out"}}})):(this.panningStyle={transition:"all .2s ease-out"},setTimeout(function(){e.protecting=!1,e.doingChangeSong=!1},200))}},swipeHandler:function(t){var e=this;if(this.protecting)return!1;this.doingChangeSong=!0,this.protecting=!0;t.deltaX>0?this.changeSong({type:"prev",beforeChange:function(){setTimeout(function(){e.protecting=!1,e.doingChangeSong=!1},200)}}):t.deltaX<0&&this.changeSong({type:"next",beforeChange:function(){setTimeout(function(){e.protecting=!1,e.doingChangeSong=!1},200)}})},enter:function(t,e){t.style.visibility="hidden",setTimeout(function(){e(),t.style.visibility=""},200)},leave:function(t,e){t.style.display="none",setTimeout(function(){e(),t.style.display=""},200)}}),created:function(){var t=this.currentSong.indexInPlaylist,e=this.playOrder.indexOf(t),n=e-1<0?this.playOrder.length-1:e-1,i=e+1>this.playOrder.length-1?0:e+1;this.pnncd=[{mark:Date.now()*Math.random(),index:this.playOrder[n]},{mark:Date.now()*Math.random(),index:t},{mark:Date.now()*Math.random(),index:this.playOrder[i]}]},deactivated:function(){this.stopAnimation="none"},activated:function(){this.stopAnimation=""},watch:{"currentSong.src":function(){var t=this;setTimeout(function(){t.stopAnimation="none"},200),setTimeout(function(){t.stopAnimation=""},700)},"currentSong.indexInPlaylist":function(t){this.commentnum="";var e=t,n=this.playOrder.indexOf(e),i=n-1<0?this.playOrder.length-1:n-1,a=n+1>this.playOrder.length-1?0:n+1;"right"===this.cdMoveDirection?(this.pnncd.pop(),this.pnncd.unshift({mark:Date.now()*Math.random(),index:this.playOrder[i]})):"left"===this.cdMoveDirection?(this.pnncd.shift(),this.pnncd.push({mark:Date.now()*Math.random(),index:this.playOrder[a]})):this.pnncd=[{mark:Date.now()*Math.random(),index:this.playOrder[i]},{mark:Date.now()*Math.random(),index:e},{mark:Date.now()*Math.random(),index:this.playOrder[a]}],this.changeCdMoveDirection("")},"currentSong.songid":function(t){var e=this;c()(this.currentServer.url+"/songcommentnum?topic="+t,{name:"jsoncallback2387000247395"+Math.floor(8999*Math.random()+1e3)},function(t,n){if(t)console.log("Get SongCommentNum Failed");else{var i=n.batch_commenttotal[0].commenttotal;e.commentnum=i<=999?i:i<1e4?"999+":i<1e5?"1w+":i<1e6?"10w+":"100w+"}})}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cd-page"},[n("v-touch",{staticClass:"cd-main",on:{tap:t.togglePage,pan:t.panHandler,swipe:t.swipeHandler}},[n("div",{staticClass:"cd-head"},[n("div",{staticClass:"cd-heads",class:t.running&&!t.doingChangeSong?"":"pause"})]),t._v(" "),n("div",{staticClass:"cd-cover-box"}),t._v(" "),n("transition-group",{staticClass:"cd-cover-list",style:t.panningStyle,attrs:{tag:"div",name:"mini-order"},on:{enter:t.enter,leave:t.leave}},t._l(t.pnncd,function(e,i){return n("div",{key:e.mark,staticClass:"cd-cover-item"},[n("div",{staticClass:"cd-cover-bg",class:t.running&&!t.doingChangeSong&&1===i?"running":"",style:{animation:t.stopAnimation}},[n("div",{directives:[{name:"src",rawName:"v-src:before-cover",value:"https://y.gtimg.cn/music/photo_new/T002R300x300M000"+t.playlist[e.index].albummid+".jpg?max_age=2592000",expression:"'https://y.gtimg.cn/music/photo_new/T002R300x300M000'+playlist[item.index].albummid+'.jpg?max_age=2592000'",arg:"before-cover"}],staticClass:"cd-cover"})])])}))],1),t._v(" "),n("div",{staticClass:"operation-group"},[n("span",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"iconfont icon-heart"}),t._v(" "),n("span",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"iconfont icon-download"}),t._v(" "),n("span",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"comment"},[n("span",{staticClass:"iconfont icon-comment",class:{shownum:t.commentnum}}),t._v(" "),n("span",{staticClass:"comment-num"},[t._v(t._s(t.commentnum))])]),t._v(" "),n("span",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"iconfont icon-more-item"})])],1)},staticRenderFns:[]};var u=n("VU/8")(l,h,!1,function(t){n("ztby"),n("S4EC")},"data-v-61fcb2c4",null).exports,g=void 0,d={data:function(){return{tiemr:null,lyric:"",lyricTrans:"",lyricArray:[],lyricLoading:!0,boxHeight:0,lineData:[],readyForChange:!1,scrollByUser:!1,willActiveIndex:null,lyricChanged:!1}},computed:a()({},Object(r.e)("player",["volume","currentSong","currentTime"]),Object(r.c)("config",["currentServer"]),{activeIndex:function(){var t=this;if(this.lyricArray.length>0){if(this.currentTime<=this.lyricArray[0].time)return 0;var e=this.lyricArray.findIndex(function(e,n,i){return n<i.length-1?t.currentTime>=e.time&&t.currentTime<i[n+1].time:n});return""===this.lyricArray[e].text?e-1<0?0:e-1:e}return 0},willActiveTime:function(){return this.lyricArray.length<1||null===this.willActiveIndex?"00:00":Object(s.b)(this.lyricArray[this.willActiveIndex].time)}}),methods:a()({},Object(r.d)("player",["changeVolume","setCurrentTime"]),{togglePage:function(t){this.$emit("togglepage")},changeVolumeHandler:function(t){var e=this.$refs.volume.getBoundingClientRect(),n=e.width,i=e.left||e.x,a=t.center.x-i,r=Math.round(a/n*100)/100;r<.05?r=0:r>.95&&(r=1),this.changeVolume(r)},panHandler:function(){this.readyForChange=!0,this.scrollByUser=!0},lyricChanger:function(){this.setCurrentTime(this.lyricArray[this.willActiveIndex].time)},requestLyric:function(t){var e=this;this.lyricLoading=!0,this.scrollByUser=!1,this.readyForChange=!1,c()(this.currentServer.url+"/songlyric?songmid="+this.currentSong.songmid,{name:"MusicJsonCallback_lrc"},function(n,i){n?(e.lyricLoading=!1,e.lyric="无歌词"):(e.lyric=Object(s.a)(i.lyric),e.lyricTrans=i.trans&&Object(s.a)(i.trans),e.lyricArray=Object(s.d)(e.lyric,e.lyricTrans),e.$nextTick(t))})},updateLineData:function(){this.lineData=this.$refs.line.map(function(t){var e=t.offsetTop,n=t.clientHeight;return{offset:e,height:n,center:e+n/2}})}}),mounted:function(){var t=this;this.requestLyric(function(){t.lyricLoading=!1,setTimeout(function(){t.updateLineData(),(g=new window.IScroll(t.$refs.lyricArea.$el,{probeType:3,click:!1,preventDefault:!1})).on("scroll",function(){if(t.readyForChange&&t.scrollByUser){var e=void 0,n=-g.y+t.boxHeight/2;e=n<t.lineData[0].center?t.willActiveIndex=0:n>t.lineData[t.lineData.length-1].center?t.willActiveIndex=t.lineData.length-1:t.lineData.findIndex(function(t,e,i){return Math.abs(t.center-n)<=t.height/2+10&&0!==t.height}),t.willActiveIndex=e,t.timer&&(clearTimeout(t.timer),t.timer=null)}}),g.on("scrollEnd",function(){t.readyForChange&&t.scrollByUser&&(t.scrollByUser=!1,g.scrollTo(0,-(t.lineData[t.willActiveIndex].center-t.boxHeight/2),1e3),t.timer=setTimeout(function(){t.readyForChange=!1,t.willActiveIndex=null,g.scrollTo(0,-(t.lineData[t.activeIndex].center-t.boxHeight/2),1e3)},5e3))}),!1===t.readyForChange&&g.scrollTo(0,-(t.lineData[t.activeIndex].center-t.boxHeight/2),1e3)},1e3)}),this.boxHeight=this.$refs.lyricArea.$el.getBoundingClientRect().height,window.onresize=function(){t.boxHeight=t.$refs.lyricArea.$el.getBoundingClientRect().height}},activated:function(){var t=this;this.lyricChanged&&(this.lyricLoading=!1,g.scrollTo(0,0,0),this.$nextTick(function(){setTimeout(function(){t.updateLineData(),g.refresh(),!1===t.readyForChange&&g.scrollTo(0,-(t.lineData[t.activeIndex].center-t.boxHeight/2),1e3)},1e3)}),this.lyricChanged=!1)},watch:{activeIndex:function(t){if(this.lineData.length>0&&!1===this.readyForChange){var e=this.lineData[t].center-this.boxHeight/2;g.scrollTo(0,-e,1e3)}},"currentSong.songmid":function(t){var e=this;this.lyricLoading=!0,this.lyricChanged=!0,this.lineData=[],this.willActiveIndex=null,this.requestLyric(function(){e.lyricLoading=!1,e.$nextTick(function(){setTimeout(function(){e.updateLineData(),g.refresh(),!1===e.readyForChange&&g.scrollTo(0,-(e.lineData[e.activeIndex].center-e.boxHeight/2),1e3)},1e3)})})}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lyric-page"},[n("div",{staticClass:"volume-area"},[n("span",{staticClass:"iconfont icon-volume"}),t._v(" "),n("v-touch",{staticClass:"volume-box",on:{tap:t.changeVolumeHandler,pan:t.changeVolumeHandler}},[n("div",{ref:"volume",staticClass:"volume-bar"},[n("div",{staticClass:"volume",style:{width:100*t.volume+"%"}},[n("div",{staticClass:"volume-button"})])])])],1),t._v(" "),n("div",{staticClass:"lyric-area"},[n("v-touch",{directives:[{name:"show",rawName:"v-show",value:t.readyForChange,expression:"readyForChange"}],staticClass:"lyric-cursor",on:{tap:t.lyricChanger}},[n("span",{staticClass:"cursor-icon"}),t._v(" "),n("hr",{staticClass:"cursor-line"}),t._v(" "),n("span",{staticClass:"cursor-time"},[t._v(t._s(t.willActiveTime))])]),t._v(" "),n("v-touch",{ref:"lyricArea",staticClass:"lyric-touch",on:{tap:t.togglePage,pan:t.panHandler}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.lyricLoading,expression:"!lyricLoading"}],staticClass:"lyric-box"},[n("div",{staticClass:"lyric-content",style:{padding:t.boxHeight/2+"px 0"}},t._l(t.lyricArray,function(e,i){return n("div",{key:"lyricI"+i,ref:"line",refInFor:!0,staticClass:"lyric-line",style:{color:t.activeIndex===i?"#fff":t.willActiveIndex===i?"#eee":""}},[n("p",{staticClass:"lyric-origin",domProps:{innerHTML:t._s(e.text)}}),t._v(" "),e.trans?n("p",{staticClass:"lyric-trans",domProps:{innerHTML:t._s(e.trans)}}):t._e()])}))]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.lyricLoading,expression:"lyricLoading"}],staticClass:"lyric-loading"},[n("span",[t._v("歌词加载中...")])])])],1)])},staticRenderFns:[]};var v={components:{cd:u,lyric:n("VU/8")(d,p,!1,function(t){n("gU6+")},"data-v-5cdcce07",null).exports,playlist:n("fydU").a},data:function(){return{showPlaylist:!1,pageBg:"",showing:"cd",title:"",timeSetting:null,progressBarWidth:"",progressBarOffset:""}},computed:a()({},Object(r.e)("player",["running","playlist","currentSong","duration","currentTime","loadedTime","loopType","dataLoading"]),Object(r.c)("player",["progress"]),{durationStr:function(){return Object(s.b)(this.duration)},currentTimeStr:function(){return null!==this.timeSetting?Object(s.b)(this.timeSetting):Object(s.b)(this.currentTime)},progressWidth:function(){return null!==this.timeSetting?this.timeSetting/this.duration*100+"%":100*this.progress+"%"},loadProgress:function(){return 0===this.duration?0:this.loadedTime/this.duration*100+"%"},loopTypeClass:function(){switch(this.loopType){case"proper":return"icon-circle";case"single":return"icon-single";case"random":return"icon-random"}}}),methods:a()({},Object(r.d)("player",["setCurrentTime","toggleLoopType","changePlayState"]),Object(r.b)("player",["changeSong"]),{scrollRound:function(t,e){t.maxScrollX<-30&&setTimeout(function(){t.scrollTo(e,0,t.maxScrollX/-30*1e3,{style:"cubic-bezier(0, 0, 1, 1)"})},2e3)},togglePage:function(){"cd"===this.showing?this.showing="lyric":"lyric"===this.showing&&(this.showing="cd")},playlistOn:function(){this.showPlaylist=!0},changeProgressPan:function(t){var e=this,n=(t.center.x-this.progressBarOffset)/this.progressBarWidth*this.duration;this.timeSetting=n<0?0:n>this.duration?this.duration:n,t.isFinal&&(this.setCurrentTime(this.timeSetting),setTimeout(function(){e.timeSetting=null},100))},changeProgressTap:function(t){var e=(t.center.x-this.progressBarOffset)/this.progressBarWidth*this.duration;this.setCurrentTime(e)}}),mounted:function(){var t=this;setTimeout(function(){var e=new Image;e.src=t.currentSong.albumcover,e.onload=function(){t.pageBg=e.src,e=null}},1e3);var e=this.title=new window.IScroll(this.$refs.firstTitle,{scrollX:!0,scrollY:!1,bounce:!1,click:!1,disableMouse:!0,disablePointer:!0,disableTouch:!0,bounceEasing:{style:"cubic-bezier(0,0,1,1)"}});e.on("scrollEnd",function(){e.maxScrollX===e.x?t.scrollRound(e,0):0===e.x&&t.scrollRound(e,e.maxScrollX)}),this.scrollRound(e,e.maxScrollX);var n=this.$refs.progress.getBoundingClientRect();this.progressBarOffset=n.x||n.left,this.progressBarWidth=n.width},watch:{"playlist.length":function(t){0===t&&"/player"===this.$route.path&&this.$router.go(-1)},"currentSong.src":function(){var t=this;this.title.scrollTo(0,0,0),this.$nextTick(function(){setTimeout(function(){t.title.refresh(),t.scrollRound(t.title,t.title.maxScrollX)},1e3)}),setTimeout(function(){var e=new Image;e.src=t.currentSong.albumcover,e.onload=function(){t.pageBg=e.src,e=null}},1e3)}}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"fade"}},[n("div",{staticClass:"player-page"},[n("div",{staticClass:"page-bg",style:{backgroundImage:"url("+t.pageBg+")"}}),t._v(" "),n("div",{staticClass:"player-header"},[n("v-touch",{staticClass:"back",on:{tap:function(e){t.$router.go(-1)}}}),t._v(" "),n("div",{ref:"firstTitle",staticClass:"header-title"},[n("div",{staticClass:"first-title-box"},[n("p",{staticClass:"first-title-content"},[t._v(t._s(t.currentSong.songname))])]),t._v(" "),n("span",{staticClass:"sub-title"},[t._v(t._s(t.currentSong.singer))])]),t._v(" "),n("span",{staticClass:"share iconfont icon-share"})],1),t._v(" "),n("div",{staticClass:"player-main"},[n("transition",{attrs:{name:"fast-fade"}},[n("keep-alive",[n(t.showing,{tag:"div",on:{togglepage:t.togglePage}})])],1)],1),t._v(" "),n("div",{staticClass:"player-footer"},[n("div",{staticClass:"progress-area"},[n("span",{staticClass:"current-time"},[t._v(t._s(t.currentTimeStr))]),t._v(" "),n("v-touch",{staticClass:"progress-can-touch",attrs:{tag:"div"},on:{tap:t.changeProgressTap,pan:t.changeProgressPan}},[n("div",{ref:"progress",staticClass:"progress-bar"},[n("div",{staticClass:"load-progress",style:{width:t.loadProgress}}),t._v(" "),n("div",{staticClass:"progress",style:{width:t.progressWidth}},[n("span",{staticClass:"progress-icon",class:{loading:t.dataLoading}})])])]),t._v(" "),n("span",{staticClass:"duration"},[t._v(t._s(t.durationStr))])],1),t._v(" "),n("div",{staticClass:"control-area"},[n("v-touch",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"loop-type iconfont",class:t.loopTypeClass,on:{tap:t.toggleLoopType}}),t._v(" "),n("v-touch",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"prev iconfont icon-prev",on:{tap:function(e){t.changeSong({type:"prev"})}}}),t._v(" "),n("v-touch",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"play iconfont icon-play-fill",class:t.running?"icon-pause":"icon-play-fill",on:{tap:function(e){t.changePlayState("toggle")}}}),t._v(" "),n("v-touch",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"next iconfont icon-next",on:{tap:function(e){t.changeSong({type:"next"})}}}),t._v(" "),n("v-touch",{directives:[{name:"touch-light",rawName:"v-touch-light"}],staticClass:"show-playlist iconfont icon-list",on:{tap:t.playlistOn}})],1)]),t._v(" "),n("playlist",{attrs:{showPlaylist:t.showPlaylist},on:{close:function(e){t.showPlaylist=!1}}})],1)])},staticRenderFns:[]};var f=n("VU/8")(v,m,!1,function(t){n("vEV+")},"data-v-f5c6986a",null);e.default=f.exports},S4EC:function(t,e){},"gU6+":function(t,e){},"vEV+":function(t,e){},ztby:function(t,e){}});
//# sourceMappingURL=1.9a6c47a21f31adbb0189.js.map